#!/usr/bin/env python3
"""
paco-add-task - Add a new task to a project
Usage: paco-add-task <project> <title> [--priority high|medium|low] [--tags tag1,tag2]
"""

import sys
import argparse
from paco_lib import add_task, init_paco_dirs, list_projects


def main():
    parser = argparse.ArgumentParser(
        description="Add a new task to a PACO project"
    )
    parser.add_argument("project", help="Project name")
    parser.add_argument("title", help="Task title")
    parser.add_argument(
        "--priority", 
        choices=["high", "medium", "low"], 
        default="medium",
        help="Task priority (default: medium)"
    )
    parser.add_argument(
        "--tags", 
        help="Comma-separated tags"
    )
    
    args = parser.parse_args()
    
    # Initialize PACO dirs
    init_paco_dirs()
    
    # Parse tags
    tags = []
    if args.tags:
        tags = [t.strip() for t in args.tags.split(",")]
    
    # Add task
    task = add_task(args.project, args.title, args.priority, tags)
    
    print(f"âœ“ Task added to '{args.project}':")
    print(f"  ID: {task['id']}")
    print(f"  Title: {task['title']}")
    print(f"  Priority: {task['priority']}")
    if tags:
        print(f"  Tags: {', '.join(tags)}")


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\nCancelled.")
        sys.exit(1)
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)
