#!/usr/bin/env python3
"""
paco-complete - Mark a task as completed
Usage: paco-complete <project> <task_id>
"""

import sys
import argparse
from paco_lib import update_task_status, load_tasks, init_paco_dirs, append_to_log


def main():
    parser = argparse.ArgumentParser(
        description="Mark a PACO task as completed"
    )
    parser.add_argument("project", help="Project name")
    parser.add_argument("task_id", type=int, help="Task ID to complete")
    
    args = parser.parse_args()
    
    # Initialize PACO dirs
    init_paco_dirs()
    
    # Find the task first
    all_tasks = load_tasks(args.project, status_filter=None)
    task = next((t for t in all_tasks if t["id"] == args.task_id), None)
    
    if not task:
        print(f"Error: Task ID {args.task_id} not found in '{args.project}'", 
              file=sys.stderr)
        sys.exit(1)
    
    if task["status"] == "completed":
        print(f"Task ID {args.task_id} is already completed")
        return
    
    # Update status
    update_task_status(args.project, args.task_id, "completed")
    
    # Log it
    append_to_log(args.project, f"✓ Completed task: {task['title']}")
    
    print(f"✓ Task completed: {task['title']}")


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\nCancelled.")
        sys.exit(1)
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)
